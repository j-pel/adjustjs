<html>
	<head>
    <meta charset='utf-8'>
		<title>Simple example for couching with CouchDB</title>
	</head>
  <style>
  </style>
  <body>
    <h1>Couching.js</h1>
    <p>This is a comodity frontend to manage a CouchDB instance.</p>
    <h2>Use case 1:</h2>
    <pre id=log>
    </pre>
		<button onclick="start();">Start</button>
		<button onclick="stop();">Delete</button>
    <!--script type="text/javascript" src="https://cdn.rawgit.com/j-pel/dynamize/master/scrolling.js"></script-->
    <script type="text/javascript" src="../couching.js"></script>
    <script type="text/javascript">

//var cdb = Couching("http://jmp-fis:5984/test");
var cdb = Couching("http://192.168.1.54:5984/test");

function start() {
  console.log(cdb);
  cdb.create();
  cdb.session()
  .then(function(data){
    console.log("session ok", data);
  })
  .catch(function(err){
    console.log("session bad", err);
  });
  return(0);
  cdb.login({
    name: '',
    password: ''
  })
  .then(function(data){
    console.log("login ok", data);
  })
  .catch(function(err){
    console.log("login bad", err);
  });
}

function testing(info) {
	console.log("testing",info)
  if (info.roles) if (info.roles.indexOf("_admin")==-1) return(0);
	console.log("Admin starting tests on",cdb);
	var doc = {
		_id: "test1",
		test: 1,
		testing: "put new document operation",
		ok: true,
		error: null
	};
	cdb.put(doc, function(info){
		assert(info,doc);
	});

	doc = {
		_id: "test2",
		test: 2,
		testing: "post new document operation",
		ok: true,
		error: null
	};
	cdb.put(doc, function(info){
		assert(info,doc);
	});

	doc = {
		_id: "test1",
		test: 3,
		testing: "put existing document operation",
		ok: null,
		error: "conflict"
	};
	cdb.put(doc, function(info){
		assert(info,doc);
	});

	cdb.get("test1",test1);
}

function stop() {
	cdb.clear();
}

/*
var u = cdb.query("main/index",{
	includeDocs: true,
	descending: true,
	limit: 10
},show);
*/

function test1(info) {
	console.log("get", info);
	info.test = 4;
	info.testing = "put existing document operation"
	cdb.put(info, function(info){
		assert(info,{
			ok: true,
			error: null
		});
	});
}

function assert(info, result) {
	console.log("assert", info, result);
}
	
function log(info) {
	//var log = document.getElementById('log');
	//log.innerText += Object.values(info);
	console.log(info);
	cdb.session(log2);
}

function log2(info) {
	console.log(info);
}
    
    </script>
  </body>
</html>
